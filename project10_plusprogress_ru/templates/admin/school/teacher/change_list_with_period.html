{% extends "admin/change_list.html" %}
{% load i18n static %}
<!-- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –±–ª–æ–∫ object-tools-items, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
{% block object-tools-items %}
<!-- –ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–≤–æ–¥–∏–º - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã—Ç—ã -->
{% endblock %}
{% block content %}
<div id="content-main">
    <!-- –ù–∞—à–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π -->
    <div style="margin-bottom: 10px; text-align: right;">
        <div style="display: inline-block; position: relative;">
            <button onclick="toggleActions()" style="background: #417690; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                ‚ö° –î–µ–π—Å—Ç–≤–∏—è <span id="actionsIcon">‚ñº</span>
            </button>
            <div id="actionsMenu" style="display: none; position: absolute; right: 0; top: 100%; background: white; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px; z-index: 1000; min-width: 200px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <ul style="list-style: none; margin: 0; padding: 0;">
                    <li style="border-bottom: 1px solid #eee;">
                        <a href="{% url 'admin:school_teacher_add' %}" style="display: block; padding: 10px 15px; text-decoration: none; color: #333;">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'import-teachers' %}" class="addlink" style="background: #28a745;">
                            ‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç —É—á–∏—Ç–µ–ª–µ–π
                        </a>
                    </li>
                    <!--    <li>
                            <a href="{% url 'download-teacher-template' %}" class="addlink" style="background: #17a2b8;">
                                üì• –®–∞–±–ª–æ–Ω Excel
                            </a>
                        </li>-->
                </ul>
            </div>
        </div>
    </div>
    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –ø–µ—Ä–∏–æ–¥—É - —Å–≤–µ—Ä–Ω—É—Ç—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
    <div class="module" style="margin-bottom: 20px; border-radius: 5px;">
        <div style="padding: 10px 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px 5px 0 0; cursor: pointer; display: flex; justify-content: space-between; align-items: center;" onclick="toggleFilter()">
            <h3 style="margin: 0;">–§–∏–ª—å—Ç—Ä –ø–æ –ø–µ—Ä–∏–æ–¥—É <span style="font-size: 0.9rem; color: #6c757d;">(–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å)</span>
            </h3>
            <span id="filterToggleIcon" style="font-size: 1.2rem;">‚ñº</span>
        </div>
        <div id="filterContent" style="display: none; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-top: none;">
            <form method="get" class="form-inline">
                <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                {% for key, value in request.GET.items %}
                {% if key != 'start_date' and key != 'end_date' and key != 'e' %}
                <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endif %}
                {% endfor %}
                <div style="display: flex; gap: 15px; align-items: flex-end;">
                    <div>
                        <label>–î–∞—Ç–∞ —Å:</label>
                        <input type="date" name="start_date" value="{{ start_date|default:'' }}" class="vTextField">
                    </div>
                    <div>
                        <label>–î–∞—Ç–∞ –ø–æ:</label>
                        <input type="date" name="end_date" value="{{ end_date|default:'' }}" class="vTextField">
                    </div>
                    <div>
                        <button type="submit" class="button" style="background: #417690; color: white;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å
                        </button>
                        <a href="{% url 'admin:school_teacher_changelist' %}" class="button" style="background: #6c757d;">–°–±—Ä–æ—Å</a>
                    </div>
                </div>
            </form>
            {% if teachers_data %}
            <div style="margin-top: 20px;">
                <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ {{ start_date }} - {{ end_date }}</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                    <tr>
                        <th style="padding: 8px; border-bottom: 2px solid #dee2e6;">–£—á–∏—Ç–µ–ª—å</th>
                        <th style="padding: 8px; border-bottom: 2px solid #dee2e6;">–í—Å–µ–≥–æ –≤—ã–ø–ª–∞—Ç</th>
                        <th style="padding: 8px; border-bottom: 2px solid #dee2e6;">–í—ã–ø–ª–∞—á–µ–Ω–æ –∑–∞—Ä–ø–ª–∞—Ç—ã</th>
                        <th style="padding: 8px; border-bottom: 2px solid #dee2e6;">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for item in teachers_data %}
                    <tr>
                        <td style="padding: 8px;">{{ item.teacher.user.get_full_name }}</td>
                        <td style="padding: 8px; color: #28a745;">{{ item.earnings.total_payments|floatformat:2 }} ‚ÇΩ
                        </td>
                        <td style="padding: 8px; color: #ffc107;">{{ item.earnings.total_salaries|floatformat:2 }} ‚ÇΩ
                        </td>
                        <td style="padding: 8px; font-weight: bold; color: #17a2b8;">{{
                            item.earnings.net_income|floatformat:2 }} ‚ÇΩ
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
    </div>
    {{ block.super }}
</div>
<script>
    function toggleFilter() {
        var content = document.getElementById('filterContent');
        var icon = document.getElementById('filterToggleIcon');

        if (content.style.display === 'none') {
            content.style.display = 'block';
            icon.innerHTML = '‚ñ≤';
        } else {
            content.style.display = 'none';
            icon.innerHTML = '‚ñº';
        }
    }

    function toggleActions() {
        var menu = document.getElementById('actionsMenu');
        var icon = document.getElementById('actionsIcon');

        if (menu.style.display === 'none') {
            menu.style.display = 'block';
            icon.innerHTML = '‚ñ≤';
        } else {
            menu.style.display = 'none';
            icon.innerHTML = '‚ñº';
        }
    }

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function(event) {
        var menu = document.getElementById('actionsMenu');
        var button = event.target.closest('button');

        if (!button || !button.innerText.includes('‚ö° –î–µ–π—Å—Ç–≤–∏—è')) {
            menu.style.display = 'none';
            document.getElementById('actionsIcon').innerHTML = '‚ñº';
        }
    });
</script>
{% endblock %}