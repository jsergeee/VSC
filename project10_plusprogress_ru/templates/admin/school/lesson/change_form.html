{% extends "admin/change_form.html" %}
{% load i18n static %}

{% block object-tools-items %}
    {{ block.super }}
    {% if original and original.status != 'completed' and original.status != 'cancelled' %}
    <li>
        <form method="post" action="{% url 'admin:complete-lesson' original.pk %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" style="background: #28a745; color: white; padding: 8px 15px; border-radius: 4px; font-weight: bold; border: none; cursor: pointer;">
                ✅ Завершить занятие
            </button>
        </form>
    </li>
    {% endif %}
{% endblock %}

{% block after_field_sets %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'scss/main.css' %}">

{% if original and original.status == 'completed' %}
<div class="module" style="margin-top: 20px;">
    <h2>Отчет о занятии</h2>

    {% if original.report %}
    <div style="padding: 15px; background: #f8f8f8; border-radius: 4px;">
        <p><strong>Тема:</strong> {{ original.report.topic }}</p>
        <p><strong>Пройденный материал:</strong></p>
        <p>{{ original.report.covered_material|linebreaks }}</p>
        <p><strong>Домашнее задание:</strong></p>
        <p>{{ original.report.homework|linebreaks }}</p>
        <p><strong>Прогресс ученика:</strong></p>
        <p>{{ original.report.student_progress|linebreaks }}</p>
        {% if original.report.next_lesson_plan %}
        <p><strong>План следующего занятия:</strong></p>
        <p>{{ original.report.next_lesson_plan|linebreaks }}</p>
        {% endif %}
        <p><strong>Создан:</strong> {{ original.report.created_at }}</p>
    </div>
    {% endif %}
</div>
{% endif %}

{% if original and original.status != 'completed' and original.status != 'cancelled' %}
<div class="module" style="margin-top: 20px; border: 2px solid #28a745; padding: 15px; background: #f8fff8;">
    <h2 style="color: #28a745;">✅ Завершить занятие</h2>

    <form method="post" action="{% url 'admin:complete-lesson' original.pk %}">
        {% csrf_token %}
        <table style="width: 100%;">
            <tr>
                <td style="width: 200px;"><label for="topic">Тема занятия:</label></td>
                <td><input type="text" id="topic" name="topic" class="vTextField" style="width: 100%;" required></td>
            </tr>
            <tr>
                <td><label for="covered_material">Пройденный материал:</label></td>
                <td><textarea id="covered_material" name="covered_material" rows="4" style="width: 100%;"
                        required></textarea></td>
            </tr>
            <tr>
                <td><label for="homework">Домашнее задание:</label></td>
                <td><textarea id="homework" name="homework" rows="3" style="width: 100%;" required></textarea></td>
            </tr>
            <tr>
                <td><label for="student_progress">Прогресс ученика:</label></td>
                <td><textarea id="student_progress" name="student_progress" rows="3" style="width: 100%;"
                        required></textarea></td>
            </tr>
            <tr>
                <td><label for="next_lesson_plan">План следующего занятия:</label></td>
                <td><textarea id="next_lesson_plan" name="next_lesson_plan" rows="3" style="width: 100%;"></textarea>
                </td>
            </tr>
        </table>

        <div class="submit-row" style="margin-top: 20px;">
            <input type="submit" value="✅ Завершить занятие и списать средства" class="default" style="background: #28a745; font-size: 16px; padding: 10px 20px;">
        </div>
    </form>
</div>
{% endif %}
{% endblock %}