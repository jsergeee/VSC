{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}

<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<link rel="stylesheet" href="{% static 'scss/main.css' %}">

<style>
.form {
    margin: 0px;
    padding: 6px!important;
}

.export-form-container {
    padding-bottom: 30px;
    margin-bottom: 20px;
    border-bottom: 1px solid #eee;  /* –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è */
}
form .button {
    margin: 0px  0px  10px  10px;
    padding: 2px 3px;
    vertical-align: middle;
    font-family: var(--font-family-primary);
    font-weight: normal;
    font-size: 0.8125rem;
}

 #calendar {
    width: 2000px;

}
</style>

{% endblock %}

{% block content %}
<div id="content-main">
    <div class="module">
        <div class="back-link">
            <a href=".">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
        </div>
        
        <div class="view-toggle">
            <a href=".">–°–ø–∏—Å–æ–∫</a>
            <a href="?view=calendar" class="active">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color scheduled"></div>
                <span>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color completed"></div>
                <span>–ü—Ä–æ–≤–µ–¥–µ–Ω–æ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color overdue"></div>
                <span>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color cancelled"></div>
                <span>–û—Ç–º–µ–Ω–µ–Ω–æ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color rescheduled"></div>
                <span>–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color no_show"></div>
                <span>–ù–µ —è–≤–∏–ª—Å—è</span>
            </div>
        </div>
<div class="d-flex" >
       <div style="display: flex; align-content: center; flex-wrap: wrap;">
            <form method="get" action="{% url 'admin_export_calendar_pdf' %}" class="d-flex gap-2" target="_blank" >
                <select name="month" class="form-control form-control-sm" style="width: 120px; align-content: center;">
                    <option value="1" {% if now.month == 1 %}selected{% endif %}>–Ø–Ω–≤–∞—Ä—å</option>
                    <option value="2" {% if now.month == 2 %}selected{% endif %}>–§–µ–≤—Ä–∞–ª—å</option>
                    <option value="3" {% if now.month == 3 %}selected{% endif %}>–ú–∞—Ä—Ç</option>
                    <option value="4" {% if now.month == 4 %}selected{% endif %}>–ê–ø—Ä–µ–ª—å</option>
                    <option value="5" {% if now.month == 5 %}selected{% endif %}>–ú–∞–π</option>
                    <option value="6" {% if now.month == 6 %}selected{% endif %}>–ò—é–Ω—å</option>
                    <option value="7" {% if now.month == 7 %}selected{% endif %}>–ò—é–ª—å</option>
                    <option value="8" {% if now.month == 8 %}selected{% endif %}>–ê–≤–≥—É—Å—Ç</option>
                    <option value="9" {% if now.month == 9 %}selected{% endif %}>–°–µ–Ω—Ç—è–±—Ä—å</option>
                    <option value="10" {% if now.month == 10 %}selected{% endif %}>–û–∫—Ç—è–±—Ä—å</option>
                    <option value="11" {% if now.month == 11 %}selected{% endif %}>–ù–æ—è–±—Ä—å</option>
                    <option value="12" {% if now.month == 12 %}selected{% endif %}>–î–µ–∫–∞–±—Ä—å</option>
                </select>

                <select name="year" class="form-control form-control-sm" style="width: 100px; align-content: center;">
                    <option value="2026" {% if now.year == 2026 %}selected{% endif %}>2026</option>
                    <option value="2027" {% if now.year == 2027 %}selected{% endif %}>2027</option>
                    <option value="2028" {% if now.year == 2028 %}selected{% endif %}>2028</option>
                </select>

                <button type="submit" class="button" style="background: #28a745;">
                    üìÑ –≠–∫—Å–ø–æ—Ä—Ç
                </button>
            </form>
    </div>
</div>

        <div id="calendar"></div>
    </div>
</div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/ru.js'></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        locale: 'ru',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        buttonText: {
            today: '–°–µ–≥–æ–¥–Ω—è',
            month: '–ú–µ—Å—è—Ü',
            week: '–ù–µ–¥–µ–ª—è',
            day: '–î–µ–Ω—å'
        },
        slotMinTime: '08:00:00',
        slotMaxTime: '22:00:00',
        allDaySlot: false,
        slotDuration: '00:30:00',
        
        events: {{ calendar_events|safe }},
        
        eventClick: function(info) {
            if (info.event.url) {
                window.location.href = info.event.url;
            }
        },
        
        eventDidMount: function(info) {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—É–ª—Ç–∏–ø —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            var props = info.event.extendedProps;
            var title = info.event.title;
            info.el.setAttribute('title', title);
        }
    });
    
    calendar.render();
});
</script>
{% endblock %}