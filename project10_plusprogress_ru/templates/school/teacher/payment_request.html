{% extends 'base.html' %}
{% load static %}

{% block title %}–ó–∞–ø—Ä–æ—Å –≤—ã–ø–ª–∞—Ç—ã{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fa fa-money"></i> –ó–∞–ø—Ä–æ—Å –≤—ã–ø–ª–∞—Ç—ã</h4>
                </div>
                <div class="card-body">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ -->
                    <div class="alert alert-info">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <strong>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ:</strong>
                                <h3>{{ stats.total_earned|floatformat:0 }} ‚ÇΩ</h3>
                            </div>
                            <div class="col-md-4 text-center">
                                <strong>–í—ã–ø–ª–∞—á–µ–Ω–æ:</strong>
                                <h3 class="text-success">{{ stats.paid|floatformat:0 }} ‚ÇΩ</h3>
                            </div>
                            <div class="col-md-4 text-center">
                                <strong>–î–æ—Å—Ç—É–ø–Ω–æ:</strong>
                                <h3 class="text-primary">{{ stats.available|floatformat:0 }} ‚ÇΩ</h3>
                            </div>
                        </div>
                    </div>

                    <form method="post" action="{% url 'teacher_request_payment' %}">
                        {% csrf_token %}

                        <div class="form-group mb-3">
                            <label for="amount">–°—É–º–º–∞ –∫ –≤—ã–ø–ª–∞—Ç–µ *</label>
                            <input type="number" class="form-control" id="amount" name="amount"
                                   min="100" max="{{ stats.available }}" step="100" required>
                            <small class="text-muted">
                                –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 100 ‚ÇΩ. –î–æ—Å—Ç—É–ø–Ω–æ: {{ stats.available|floatformat:0 }} ‚ÇΩ
                            </small>
                        </div>

                        <div class="form-group mb-3">
                            <label for="payment_method">–°–ø–æ—Å–æ–± –≤—ã–ø–ª–∞—Ç—ã *</label>
                            <select class="form-control" id="payment_method" name="payment_method" required>
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± --</option>
                                <option value="bank_card">üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
                                <option value="bank_account">üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç</option>
                                <option value="yoomoney">üí∞ –ÆMoney</option>
                                <option value="cash">üíµ –ù–∞–ª–∏—á–Ω—ã–º–∏</option>
                            </select>
                        </div>

                        <div class="form-group mb-4">
                            <label for="payment_details">–ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã *</label>
                            <textarea class="form-control" id="payment_details" name="payment_details"
                                      rows="3" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã / —Å—á–µ—Ç–∞ / –∫–æ—à–µ–ª—å–∫–∞" required></textarea>
                            <small class="text-muted">–£–∫–∞–∂–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã</small>
                        </div>

                        <div class="alert alert-warning">
                            <i class="fa fa-exclamation-triangle"></i>
                            <strong>–í–∞–∂–Ω–æ:</strong> –ó–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ.
                            –ë–∞–ª–∞–Ω—Å –Ω–µ –±—É–¥–µ—Ç —Å–ø–∏—Å–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –∑–∞—è–≤–∫—É –∏ –ø—Ä–æ–≤–µ–¥–µ—Ç –≤—ã–ø–ª–∞—Ç—É –≤—Ä—É—á–Ω—É—é.
                        </div>

                        <div class="form-group text-center">
                            <button type="submit" class="btn btn-success btn-lg px-5">
                                <i class="fa fa-check"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
                            </button>
                            <a href="{% url 'teacher_dashboard' %}#payments" class="btn btn-secondary btn-lg px-5 ml-2">
                                <i class="fa fa-times"></i> –û—Ç–º–µ–Ω–∞
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ -->
{% if recent_requests %}
<div class="card mt-4">
    <div class="card-header bg-warning text-white">
        <h5 class="mb-0"><i class="fa fa-clock-o"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in recent_requests %}
                    <tr>
                        <td>#{{ req.id }}</td>
                        <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
                        <td>{{ req.amount }} ‚ÇΩ</td>
                        <td>
                            {% if req.status == 'pending' %}
                                <span class="badge badge-warning">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>
                            {% elif req.status == 'approved' %}
                                <span class="badge badge-info">‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ</span>
                            {% elif req.status == 'rejected' %}
                                <span class="badge badge-danger">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                            {% elif req.status == 'paid' %}
                                <span class="badge badge-success">üí∞ –í—ã–ø–ª–∞—á–µ–Ω–æ</span>
                            {% endif %}
                        </td>
                        <td>{{ req.comment|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
            <!-- –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ) -->
            {% if real_payments %}
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fa fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for payment in real_payments %}
                                <tr>
                                    <td>{{ payment.created_at|date:"d.m.Y H:i" }}</td>
                                    <td class="text-success">{{ payment.amount }} ‚ÇΩ</td>
                                    <td>{{ payment.description|default:"–í—ã–ø–ª–∞—Ç–∞" }}</td>
                                    <td><span class="badge badge-success">‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}