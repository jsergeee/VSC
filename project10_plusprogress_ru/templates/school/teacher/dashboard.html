{% extends 'base.html' %} {% load static %} {% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
—É—á–∏—Ç–µ–ª—è{% endblock %} {% block extra_css %}
<link
  href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css"
  rel="stylesheet"
/>
<style>


  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
  .calendar-header {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
  }
  .form {
    margin: 0px;
    padding: 6px!important;
}
 .form-control {
    padding: 0px!important;
}

  .fc-toolbar-title {
    font-size: 1.5rem !important;
    font-weight: 600 !important;
    color: #495057 !important;
  }

  .fc-button {
    background: #f8f9fa !important;
    border: 2px solid #e9ecef !important;
    color: #495057 !important;
    font-weight: 600 !important;
    padding: 8px 15px !important;
    border-radius: 10px !important;
    transition: all 0.3s ease !important;
  }

  .fc-button:hover {
    background: #667eea !important;
    border-color: #667eea !important;
    color: white !important;
  }

  .fc-button-active {
    background: #667eea !important;
    border-color: #667eea !important;
    color: white !important;
  }

  .btn-create {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 50px;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  .btn-create:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    color: white;
  }

  .btn-create i {
    margin-right: 8px;
    font-size: 1.1rem;
  }

  .quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
  }

  .stat-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #667eea;
    line-height: 1.2;
    margin-bottom: 5px;
  }

  .stat-label {
    color: #6c757d;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .nav-tabs-custom {
    border-bottom: 2px solid #e9ecef;
    margin-bottom: 25px;
    padding: 0 15px;
  }

  .nav-tabs-custom .nav-item {
    margin-bottom: -2px;
  }

  .nav-tabs-custom .nav-link {
    border: none;
    color: #6c757d;
    font-weight: 600;
    padding: 15px 25px;
    border-radius: 0;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
  }

  .nav-tabs-custom .nav-link i {
    margin-right: 8px;
    font-size: 1.1rem;
  }

  .nav-tabs-custom .nav-link:hover {
    color: #667eea;
  }

  .nav-tabs-custom .nav-link.active {
    color: #667eea;
    background: transparent;
    border-bottom: 2px solid #667eea;
  }

  .tab-content {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
    min-height: 400px;
  }
</style>
{% endblock %} {% block content %}
<div class="container mt-4">
  <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
  <div class="row mb-4">
    <div class="col-12">
      <h2>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ user.first_name }}!</h2>
    </div>
  </div>
  <!-- –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="quick-stats">
    <div class="stat-card">
      <div class="stat-number">{{ students.count }}</div>
      <div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ upcoming_lessons|length }}</div>
      <div class="stat-label">–ë–ª–∏–∂–∞–π—à–∏—Ö –∑–∞–Ω—è—Ç–∏–π</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ today_lessons|length }}</div>
      <div class="stat-label">–ó–∞–Ω—è—Ç–∏–π —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ materials|length }}</div>
      <div class="stat-label">–ú–æ–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
    </div>
  </div>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
  <ul class="nav nav-tabs-custom" id="myTab" role="tablist">
    <li class="nav-item">
      <a
        class="nav-link active"
        id="schedule-tab"
        data-toggle="tab"
        href="#schedule"
        role="tab"
      >
        <i class="fa fa-calendar"></i> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="students-tab"
        data-toggle="tab"
        href="#students"
        role="tab"
      >
        <i class="fa fa-users"></i> –ú–æ–∏ —É—á–µ–Ω–∏–∫–∏
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="homeworks-tab"
        data-toggle="tab"
        href="#homeworks"
        role="tab"
      >
        <i class="fa fa-book"></i> –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="payments-tab"
        data-toggle="tab"
        href="#payments"
        role="tab"
      >
        <i class="fa fa-money"></i> –í—ã–ø–ª–∞—Ç—ã
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="materials-tab"
        data-toggle="tab"
        href="#materials"
        role="tab"
      >
        <i class="fa fa-file"></i> –ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        id="history-tab"
        data-toggle="tab"
        href="#history"
        role="tab"
      >
        <i class="fa fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –∑–∞–Ω—è—Ç–∏–π
      </a>
    </li>
  </ul>
  <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->

  <div class="tab-content">
    <!-- –í–∫–ª–∞–¥–∫–∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–∫–∞–ª–µ–Ω–¥–∞—Ä—å) -->

    <div class="tab-pane fade show active" id="schedule" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h4>
    <div class="d-flex gap-2">
        <form method="get" action="{% url 'teacher_export_calendar_pdf' %}" class="d-flex gap-2" target="_blank">
            <select name="month" class="form-control form-control-sm" style="width: 120px;">
                <option value="1" {% if now.month == 1 %}selected{% endif %}>–Ø–Ω–≤–∞—Ä—å</option>
                <option value="2" {% if now.month == 2 %}selected{% endif %}>–§–µ–≤—Ä–∞–ª—å</option>
                <option value="3" {% if now.month == 3 %}selected{% endif %}>–ú–∞—Ä—Ç</option>
                <option value="4" {% if now.month == 4 %}selected{% endif %}>–ê–ø—Ä–µ–ª—å</option>
                <option value="5" {% if now.month == 5 %}selected{% endif %}>–ú–∞–π</option>
                <option value="6" {% if now.month == 6 %}selected{% endif %}>–ò—é–Ω—å</option>
                <option value="7" {% if now.month == 7 %}selected{% endif %}>–ò—é–ª—å</option>
                <option value="8" {% if now.month == 8 %}selected{% endif %}>–ê–≤–≥—É—Å—Ç</option>
                <option value="9" {% if now.month == 9 %}selected{% endif %}>–°–µ–Ω—Ç—è–±—Ä—å</option>
                <option value="10" {% if now.month == 10 %}selected{% endif %}>–û–∫—Ç—è–±—Ä—å</option>
                <option value="11" {% if now.month == 11 %}selected{% endif %}>–ù–æ—è–±—Ä—å</option>
                <option value="12" {% if now.month == 12 %}selected{% endif %}>–î–µ–∫–∞–±—Ä—å</option>
            </select>

            <select name="year" class="form-control form-control-sm" style="width: 100px;">
                <option value="2024" {% if now.year == 2024 %}selected{% endif %}>2024</option>
                <option value="2025" {% if now.year == 2025 %}selected{% endif %}>2025</option>
                <option value="2026" {% if now.year == 2026 %}selected{% endif %}>2026</option>
                <option value="2027" {% if now.year == 2027 %}selected{% endif %}>2027</option>
                <option value="2028" {% if now.year == 2028 %}selected{% endif %}>2028</option>
            </select>

            <button type="submit" class="btn btn-success btn-sm">
                üìÑ –≠–∫—Å–ø–æ—Ä—Ç
            </button>
        </form>
    </div>
</div>
      <div class="calendar-header">
        <a href="{% url 'teacher_create_schedule' %}" class="btn-create">
          <i class="fa fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫ / —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        </a>
      </div>
      <div class="row">
        <div class="col-12">
          <div id="calendar"></div>
        </div>
      </div>
    </div>
    <!-- –í–∫–ª–∞–¥–∫–∞ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–Ω—è—Ç–∏–π -->
    <div class="tab-pane fade" id="history" role="tabpanel">
      <div class="row">
        <div class="col-12">
          <h4 class="section-title mb-4">–ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</h4>
          {% if past_lessons %} {% for lesson in past_lessons %}
          <a
            href="{% url 'teacher_lesson_detail' lesson.id %}"
            style="text-decoration: none; color: inherit"
          >
            <div
              class="lesson-item completed p-3 mb-3 border rounded hover-shadow"
              style="transition: all 0.3s; display: block; background: white"
            >
              <div class="row align-items-center">
                <div class="col-md-2">
                  <strong>{{ lesson.date|date:"d.m.Y" }}</strong><br />
                  <small class="text-muted"
                    >{{ lesson.start_time|time:"H:i" }} - {{ lesson.end_time|time:"H:i" }}</small
                  >
                </div>
                <div class="col-md-3">
                  <strong>{{ lesson.subject.name }}</strong><br />
                  <small class="text-muted">
                    {% for attendance in lesson.attendance.all %} {{ attendance.student.user.get_full_name }}{% if not forloop.last %}, {% endif %} {% endfor %}
                  </small>
                </div>
                <div class="col-md-2">
                  <span class="badge badge-success px-3 py-2">–ü—Ä–æ–≤–µ–¥–µ–Ω–æ</span>
                </div>
                <div class="col-md-3 text-right">
                  {% if lesson.report %}
                  <span class="badge badge-info px-3 py-2 mr-2">
                    <i class="fa fa-file-text"></i> –û—Ç—á–µ—Ç
                  </span>
                  {% endif %} {% if lesson.feedback %}
                  <span class="badge badge-warning px-3 py-2">
                    <i class="fa fa-star"></i> –û—Ü–µ–Ω–∫–∞: {{ lesson.feedback.rating
                    }}/5
                  </span>
                  {% else %}
                  <span class="badge badge-secondary px-3 py-2">
                    <i class="fa fa-star"></i> –ù–µ—Ç –æ—Ü–µ–Ω–∫–∏
                  </span>
                  {% endif %}
                </div>
                <div class="col-md-2 text-right">
                  <small class="text-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</small>
                </div>
              </div>
              {% if lesson.feedback and lesson.feedback.comment %}
              <div class="row mt-2">
                <div class="col-12">
                  <div class="bg-light p-2 rounded">
                    <i class="fa fa-quote-left text-muted mr-2"></i>
                    {{ lesson.feedback.comment|truncatechars:100 }}
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </a>
          {% endfor %} {% else %}
          <div class="empty-state text-center py-5">
            <i class="fa fa-history fa-4x text-muted mb-3"></i>
            <h5>–ù–µ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π</h5>
            <p class="text-muted">–ò—Å—Ç–æ—Ä–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö –∑–∞–Ω—è—Ç–∏–π</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (–∑–∞–≥–ª—É—à–∫–∏) -->
    <div class="tab-pane fade" id="students">
      <div class="text-center py-5">
        <i class="fa fa-users fa-4x text-muted mb-3"></i>
        <h4>–ú–æ–∏ —É—á–µ–Ω–∏–∫–∏</h4>
        <p class="text-muted">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
      </div>
    </div>
    <div class="tab-pane fade" id="homeworks">
      <div class="text-center py-5">
        <i class="fa fa-book fa-4x text-muted mb-3"></i>
        <h4>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h4>
        <p class="text-muted">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
      </div>
    </div>
    <div class="tab-pane fade" id="payments">
      <div class="text-center py-5">
        <i class="fa fa-money fa-4x text-muted mb-3"></i>
        <h4>–í—ã–ø–ª–∞—Ç—ã</h4>
        <p class="text-muted">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
      </div>
    </div>
    <div class="tab-pane fade" id="materials">
      <div class="text-center py-5">
        <i class="fa fa-file fa-4x text-muted mb-3"></i>
        <h4>–ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h4>
        <p class="text-muted">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
      </div>
    </div>
    <div class="tab-pane fade" id="history">
      <div class="text-center py-5">
        <i class="fa fa-history fa-4x text-muted mb-3"></i>
        <h4>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–Ω—è—Ç–∏–π</h4>
        <p class="text-muted">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/ru.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      if (calendarEl) {
          var calendar = new FullCalendar.Calendar(calendarEl, {
              initialView: 'dayGridMonth',
              locale: 'ru',
              headerToolbar: {
                  left: 'prev,next today',
                  center: 'title',
                  right: 'dayGridMonth,timeGridWeek,timeGridDay'
              },
              buttonText: {
                  today: '–°–µ–≥–æ–¥–Ω—è',
                  month: '–ú–µ—Å—è—Ü',
                  week: '–ù–µ–¥–µ–ª—è',
                  day: '–î–µ–Ω—å'
              },
                  slotMinTime: '08:00:00',  // ‚Üê –ß–ê–°–´ –ù–ê–ß–ê–õ–ê (8 —É—Ç—Ä–∞)
                  slotMaxTime: '22:00:00',  // ‚Üê –ß–ê–°–´ –û–ö–û–ù–ß–ê–ù–ò–Ø (10 –≤–µ—á–µ—Ä–∞)
                  allDaySlot: false,
                  slotDuration: '00:30:00',
              events: {{ calendar_events|safe }},
                        // ‚ö°‚ö°‚ö° –≠–¢–û –†–ï–®–ï–ù–ò–ï ‚ö°‚ö°‚ö°
              eventDisplay: 'block',  // –∏–ª–∏ 'list-item'
              displayEventTime: false,  // –ù–ï –ü–û–ö–ê–ó–´–í–ê–¢–¨ –í–†–ï–ú–Ø
              eventClick: function(info) {
                  if (info.event.url) {
                      window.location.href = info.event.url;
                      info.jsEvent.preventDefault();
                  }
              }
          });
          calendar.render();
      }
  });
</script>
{% endblock %}
